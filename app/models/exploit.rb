class Exploit < ActiveRecord::Base
  belongs_to :exploit_type
  belongs_to :exploit_platform
  belongs_to :user

  has_attached_file :custom_file
  validates_attachment :custom_file, content_type: {not: ["application/pdf", "application/vnd.android.package-archive", "image/jpg", "image/jpeg", "image/png", "image/gif", "application/x-rar-compressed", "application/zip", "application/x-msdownload", "audio/mpeg", "audio/mp4", "video/mp4"] }, size: { in: 0..2.megabytes }
  
  default_scope { order(date: 'DESC') }

  scope:custom_exploit, -> {where(source: "exploit-custom")}

  def self.search(query)
  	return Exploit.all.joins(:exploit_type).joins(:exploit_platform).where("description LIKE ? OR exploit_types.title LIKE ? OR exploit_platforms.title LIKE ?", "%#{query}%", "%#{query}%", "%#{query}%")
  end
end
